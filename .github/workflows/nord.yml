name: Test NordVPN Connection (Docker)

on:
  workflow_dispatch:

jobs:
  test-nordvpn:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Run NordVPN inside Docker
        run: |
          docker run --rm --privileged ubuntu:latest bash -c '
            set -e
            export DEBIAN_FRONTEND=noninteractive
            apt update && apt install -y curl wget sudo
            wget -qO - https://downloads.nordcdn.com/apps/linux/install.sh | sudo bash
            sudo apt update && sudo apt install -y nordvpn
            nordvpn login --token "${{ secrets.NORDVPN_TOKEN }}"
            nordvpn set technology nordlynx
            nordvpn connect
            sleep 10
            echo "Connected IP: $(curl -s https://api64.ipify.org)"
          '
